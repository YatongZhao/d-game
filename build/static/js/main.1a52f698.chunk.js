(this["webpackJsonpd-game"]=this["webpackJsonpd-game"]||[]).push([[0],{19:function(e,t,i){},21:function(e,t,i){"use strict";i.r(t);var n=i(4),s=i.n(n),o=i(14),h=i.n(o),a=(i(19),i(3)),r=i(5),l=i(1),c=i(2),u=function(){function e(t,i,n){Object(l.a)(this,e),this.x=0,this.y=0,this.coordinate=void 0,this.x=t,this.y=i,this.coordinate=n}return Object(c.a)(e,[{key:"toNumber",value:function(){return[this.x+this.coordinate.origin[0],this.y+this.coordinate.origin[1]]}},{key:"plus",value:function(t,i){return new e(this.x+t,this.y+i,this.coordinate)}},{key:"lengthTo",value:function(e){var t=this.toNumber(),i=e.toNumber();return Math.pow(Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2),.5)}}]),e}(),d=function(){function e(t,i){Object(l.a)(this,e),this.origin=[0,0],this.origin=[t,i]}return Object(c.a)(e,[{key:"resetOrigin",value:function(e){this.origin=e.toNumber()}},{key:"point",value:function(e,t){return new u(e,t,this)}},{key:"toPoint",value:function(e,t){return new u(e-this.origin[0],t-this.origin[1],this)}}]),e}(),f=function(e,t,i,n,s,o){i<2*s&&(s=i/2),n<2*s&&(s=n/2),o.beginPath(),o.moveTo(e+s,t),o.arcTo(e+i,t,e+i,t+n,s),o.arcTo(e+i,t+n,e,t+n,s),o.arcTo(e,t+n,e,t,s),o.arcTo(e,t,e+i,t,s),o.closePath(),o.stroke()},g=function(e,t,i,n,s){var o=e.toNumber(),h=Object(a.a)(o,2),l=h[0],c=h[1],u=t.toNumber(),d=Object(a.a)(u,2),f=d[0]-l,g=d[1]-c,m=e.lengthTo(t),v=f/m,p=g/m;i.strokeStyle=n||"white",i.shadowColor=s||"blue",i.shadowBlur=14,i.shadowOffsetX=0,i.shadowOffsetY=0,i.beginPath(),i.lineWidth=1,i.moveTo.apply(i,Object(r.a)(e.toNumber()));for(var b=1;b<5;b++){var y=e.plus(f/5*b,g/5*b),S=60*(Math.random()-.5);y=y.plus(S*p,S*v),i.lineTo.apply(i,Object(r.a)(y.toNumber()))}i.lineTo.apply(i,Object(r.a)(t.toNumber())),i.stroke(),i.closePath(),i.beginPath(),i.lineWidth=2,i.moveTo.apply(i,Object(r.a)(e.toNumber()));for(var O=1;O<5;O++){var w=e.plus(f/5*O,g/5*O),k=60*(Math.random()-.5);w=w.plus(k*p,k*v),i.lineTo.apply(i,Object(r.a)(w.toNumber()))}i.lineTo.apply(i,Object(r.a)(t.toNumber())),i.stroke(),i.closePath(),i.shadowBlur=0,i.lineWidth=1,i.strokeStyle="black"},m=function(){function e(t,i,n){Object(l.a)(this,e),this.value=0,this.size=20,this.point=void 0,this.game=void 0,this.value=t,this.game=n,this.point=new u(i,-this.size,n.coordinate)}return Object(c.a)(e,[{key:"go",value:function(){this.point.y+=.5}},{key:"hited",value:function(){return this.value--,this.game.score++,this.value<=0&&(this.game.removeEnemy(this),!0)}},{key:"render",value:function(e){var t=this.point.toNumber(),i=Object(a.a)(t,2),n=i[0],s=i[1];f(n,s,this.size,this.size,5,e),e.textAlign="center",e.fillText("".concat(this.value),n+this.size/2,s+13)}}]),e}(),v=i(11),p=i(10),b=function(){function e(t,i,n,s,o){Object(l.a)(this,e),this.point=void 0,this.game=void 0,this.size=2,this.direction=0,this.speed=30,this.hero=void 0,this.point=t,this.direction=i,this.game=n,this.hero=s,o&&(this.speed=o)}return Object(c.a)(e,[{key:"go",value:function(){for(var e=this,t=0;t<5*this.speed;t++){if(this.point.y-=Math.cos(this.direction),this.point.x+=Math.sin(this.direction),this.game.enemys.some((function(t){return e.point.x>=t.point.x-2&&e.point.y>=t.point.y-2&&e.point.x<=t.point.x+t.size+2&&e.point.y<=t.point.y+t.size+2&&(t.hited()&&e.hero.addKillNumber(),e.game.removeBullet(e),!0)})))return}(this.point.y<0||this.point.y>this.game.height||this.point.x<0||this.point.x>this.game.width)&&this.game.removeBullet(this)}},{key:"render",value:function(e){var t=this.point.toNumber(),i=Object(a.a)(t,2),n=i[0],s=i[1];e.beginPath(),e.moveTo(n,s),e.lineTo(n-Math.sin(this.direction)*this.speed,s+Math.cos(this.direction)*this.speed);var o=e.createLinearGradient(n,s,n-Math.sin(this.direction)*this.speed,s+Math.cos(this.direction)*this.speed);o.addColorStop(0,"black"),o.addColorStop(1,"white"),e.strokeStyle=o,e.stroke(),e.closePath(),e.strokeStyle="black"}}]),e}(),y=function(){function e(t){Object(l.a)(this,e),this.point=void 0,this.level=1,this.color="blue",this.type="hero",this.step=0,this.killNumber=0,this.game=void 0,this.game=t,this.point=new u(0,0,t.coordinate)}return Object(c.a)(e,[{key:"size",get:function(){switch(this.level){case 1:case 2:return 30;default:case 3:return 30}}},{key:"addKillNumber",value:function(){this.killNumber++,100===this.killNumber&&(this.killNumber=0)}},{key:"go",value:function(){this.step++}},{key:"render",value:function(e,t){var i=t||this.point.toNumber(),n=Object(a.a)(i,2),s=n[0],o=n[1];e.strokeStyle=this.color,f(s,o,this.size,this.size,5,e),e.strokeStyle="black",e.fillStyle="white",e.fill(),e.fillStyle=this.color,e.textAlign="center",e.fillText("".concat(this.level),s+this.size/2,o+18),e.fillStyle="green",e.strokeStyle="green",f(s+1,o+this.size+3,this.killNumber/100*(this.size-2),2,1,e),e.fill(),e.strokeStyle="black",e.fillStyle="white",e.fillStyle="black"}},{key:"isPointIn",value:function(e,t){var i=this.point.toNumber(),n=Object(a.a)(i,2),s=n[0],o=n[1];return e>=s-10&&e<=s+this.size+10&&t>=o-10&&t<=o+this.size+10}},{key:"addToOffStage",value:function(e){}}]),e}(),S=function(e){Object(v.a)(i,e);var t=Object(p.a)(i);function i(){var e;Object(l.a)(this,i);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).type="grapeshot-hero",e.color="black",e}return Object(c.a)(i,[{key:"cycle",get:function(){switch(this.level){case 1:return 5;case 2:return 3;default:case 3:return 1}}},{key:"go",value:function(){if(this.step%this.cycle===0)for(var e=0;e<5;e++)this.game.bullets.push(new b(this.point.plus(this.size/2,0),.4*Math.PI*(Math.random()-.5),this.game,this,30+Math.floor(30*Math.random())));this.step++}}]),i}(y),O=i(13),w=i(7),k=function(e){Object(v.a)(i,e);var t=Object(p.a)(i);function i(){var e;Object(l.a)(this,i);for(var n=arguments.length,s=new Array(n),o=0;o<n;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).type="lightning-hero",e.targets={length:0,chain:null,end:null},e}return Object(c.a)(i,[{key:"cycle",get:function(){switch(this.level){case 1:return 3;case 2:return 2;default:case 3:return 1}}},{key:"_color",get:function(){switch(this.level){case 1:case 2:return"white";default:case 3:return"black"}}},{key:"_lightColor",get:function(){switch(this.level){case 1:return"blue";case 2:return"red";default:case 3:return"red"}}},{key:"targetMaxLength",get:function(){switch(this.level){case 1:return 2;case 2:return 3;default:case 3:return 5}}},{key:"go",value:function(){if(this.targets.length<this.targetMaxLength&&this.game.enemys.length>=this.targetMaxLength){for(var e=this.targetMaxLength-this.targets.length;0!==e;){var t=this.game.enemys.length,i=Math.floor(t*Math.random());if(this.targets.chain)this.addTarget({value:this.game.enemys[i],next:null})&&e--;else this.addTarget({value:this.game.enemys[i],next:null}),e--}this.targets.length=this.targetMaxLength}if(this.step%this.cycle===0){for(var n=this.targets.chain;n;){n.value.hited()&&this.addKillNumber(),n=n.next}if(!(n=this.targets.chain))return;if(n.value.value<=0)this.targets.length=0,this.targets.chain=null,this.targets.end=null;else{var s=n;n=n.next;for(var o=1;n;){if(n.value.value<=0){s.next=null,this.targets.length=o,this.targets.end=s;break}s=n,n=n.next,o++}}}this.step++}},{key:"render",value:function(e,t){if(Object(O.a)(Object(w.a)(i.prototype),"render",this).call(this,e,t),this.targets.chain)for(var n=this.targets.chain,s=this.point.plus(this.size/2,0);n;){var o=n.value.point.plus(n.value.size/2,n.value.size/2);g(s,o,e,this._color,this._lightColor),s=n.value.point.plus(n.value.size/2,n.value.size/2),n=n.next}}},{key:"addTarget",value:function(e){if(null===this.targets.end)this.targets.chain=e,this.targets.end=e,this.targets.length++;else{for(var t=this.targets.chain;t;){if(e===t)return!1;t=t.next}this.targets.end.next=e,this.targets.end=this.targets.end.next,this.targets.length++}return!0}},{key:"addToOffStage",value:function(e){Object(O.a)(Object(w.a)(i.prototype),"addToOffStage",this).call(this,e),this.targets={length:0,chain:null,end:null}}}]),i}(y),j=/Android|webOS|iPhone|iPod|BlackBerry/i.test(window.navigator.userAgent),x=function(){function e(){Object(l.a)(this,e),this.coordinate=new d(0,0),this.enemys=[],this.offStageHeros=[null,null,null,null,null,null,null,null,null],this.onStageHeros=[null,null,null,null,null,null,null,null,null],this.bullets=[],this.width=460,this.height=460*window.innerHeight/window.innerWidth,this.sizeRate=460/window.innerWidth,this.targetY=this.height-150,this.targetLineLeft=this.coordinate.point(0,this.targetY),this.targetLineRight=this.coordinate.point(this.width,this.targetY),this.offStageHeroY=this.height-70,this.onStageHeroY=this.height-120,this.heroPosList=[new u(55,this.offStageHeroY,this.coordinate),new u(95,this.offStageHeroY,this.coordinate),new u(135,this.offStageHeroY,this.coordinate),new u(175,this.offStageHeroY,this.coordinate),new u(215,this.offStageHeroY,this.coordinate),new u(255,this.offStageHeroY,this.coordinate),new u(295,this.offStageHeroY,this.coordinate),new u(335,this.offStageHeroY,this.coordinate),new u(375,this.offStageHeroY,this.coordinate),new u(55,this.onStageHeroY,this.coordinate),new u(95,this.onStageHeroY,this.coordinate),new u(135,this.onStageHeroY,this.coordinate),new u(175,this.onStageHeroY,this.coordinate),new u(215,this.onStageHeroY,this.coordinate),new u(255,this.onStageHeroY,this.coordinate),new u(295,this.onStageHeroY,this.coordinate),new u(335,this.onStageHeroY,this.coordinate),new u(375,this.onStageHeroY,this.coordinate)],this.cycle=60,this.step=0,this.setEnd=null,this.$=300,this.score=0,this.isMouseDown=!1,this.mouseSelectItem=null,this.mouseSelectItemType="off",this.mouseSelectItemIndex=0,this.mouseSelectItemPosition=[0,0],this.mouseSelectItemOffset=[0,0],this.go(),this.handleMouseMove=this.handleMouseMove.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this)}return Object(c.a)(e,[{key:"restart",value:function(){this.enemys=[],this.offStageHeros=[null,null,null,null,null,null,null,null,null],this.onStageHeros=[null,null,null,null,null,null,null,null,null],this.bullets=[],this.step=0,this.$=300,this.score=0,this.go()}},{key:"addEnemy",value:function(){for(var e=0;e<15;e++)this.enemys.push(new m(Math.ceil(this.step/300*Math.random()+1),30*e+10,this))}},{key:"removeBullet",value:function(e){this.bullets=this.bullets.filter((function(t){return t!==e}))}},{key:"removeEnemy",value:function(e){this.enemys=this.enemys.filter((function(t){return t!==e})),this.$++}},{key:"buyHero",value:function(e){switch(e){case"lightning":if(this.$<300)return!1;this.$-=300,this.addOffStageHero(new k(this));break;case"grapeshot":default:if(this.$<300)return!1;this.$-=300,this.addOffStageHero(new S(this))}return!0}},{key:"go",value:function(){this.step%this.cycle===0&&this.addEnemy(),this.enemys.forEach((function(e){e.go()})),this.onStageHeros.forEach((function(e){null===e||void 0===e||e.go()})),this.bullets.forEach((function(e){e.go()})),this.step++}},{key:"render",value:function(e){var t=this;if(e){var i=e.getContext("2d");if(i){this.go(),i.clearRect(0,0,e.width,e.height),i.strokeRect.apply(i,Object(r.a)(this.coordinate.origin).concat([this.width,this.height])),i.beginPath(),i.strokeStyle="grey",this.heroPosList.forEach((function(e){f.apply(void 0,Object(r.a)(e.plus(8,8).toNumber()).concat([14,14,5,i]))})),i.strokeStyle="black",i.closePath(),i.beginPath(),this.offStageHeros.forEach((function(e){null===e||void 0===e||e.render(i)})),this.onStageHeros.forEach((function(e){null===e||void 0===e||e.render(i)})),i.closePath();var n=!1;this.enemys.forEach((function(e){e.render(i),e.point.y>=t.targetY-e.size&&(n=!0)})),i.beginPath(),i.moveTo.apply(i,Object(r.a)(this.targetLineLeft.toNumber())),i.lineTo.apply(i,Object(r.a)(this.targetLineRight.toNumber())),i.stroke(),i.closePath(),i.beginPath(),this.bullets.forEach((function(e){e.render(i)})),i.closePath(),this.mouseSelectItem&&(this.mouseSelectItem.render(i,[this.mouseSelectItemPosition[0]+this.mouseSelectItemOffset[0],this.mouseSelectItemPosition[1]+this.mouseSelectItemOffset[1]]),j&&(i.putImageData(i.getImageData(0,this.targetY,this.width,150),0,this.targetY-150),i.rect(0,this.targetY-150,this.width,150),i.stroke())),i.beginPath(),i.font="bold 24px Arial",i.fillStyle="red",i.textAlign="right",i.fillText("$:".concat(this.$),440,30),i.font="12px Arial",i.fillStyle="black",i.closePath(),i.beginPath(),i.font="bold 24px Arial",i.fillStyle="red",i.textAlign="left",i.fillText("score:".concat(this.score),20,30),i.font="12px Arial",i.fillStyle="black",i.closePath(),n?this.setEnd&&this.setEnd(!0):requestAnimationFrame((function(){t.render(e)}))}}}},{key:"addOffStageHero",value:function(e,t){if(void 0===t&&this.offStageHeros.some((function(e,i){return null===e&&(t=i,!0)})),void 0!==t&&(this.offStageHeros[t]=e,e)){if(e.point.y=this.offStageHeroY,e.point.x=55+40*t,e.addToOffStage(t),e.level>=3)return;var i=[];this.offStageHeros.forEach((function(t,n){(null===t||void 0===t?void 0:t.type)===e.type&&e.level===t.level&&i.push(n)})),i.length>=3&&(this.addOffStageHero(null,i[0]),this.addOffStageHero(null,i[1]),this.offStageHeros[i[2]].level+=1,this.addOffStageHero(this.offStageHeros[i[2]],i[2]))}}},{key:"addOnStageHero",value:function(e,t){if(void 0===t&&this.onStageHeros.some((function(e,i){return null===e&&(t=i,!0)})),void 0!==t&&(this.onStageHeros[t]=e,e)){if(e.point.y=this.onStageHeroY,e.point.x=55+40*t,e.level>=3)return;var i=[];this.onStageHeros.forEach((function(t,n){(null===t||void 0===t?void 0:t.type)===e.type&&e.level===t.level&&i.push(n)})),i.length>=3&&(this.addOnStageHero(null,i[0]),this.addOnStageHero(null,i[1]),this.onStageHeros[i[2]].level+=1,this.addOnStageHero(this.onStageHeros[i[2]],i[2]))}}},{key:"handleCanvasMouseDown",value:function(e){this.isMouseDown=!0;var t=this.findHero(this.offStageHeros,e.clientX,e.clientY,"off"),i=this.findHero(this.onStageHeros,e.clientX,e.clientY,"on");(t||i)&&window.addEventListener("mousemove",this.handleMouseMove)}},{key:"handleTouchStart",value:function(e){(e.stopPropagation(),e.preventDefault(),this.isMouseDown=!0,this.findHero(this.offStageHeros,e.touches[0].clientX,e.touches[0].clientY,"off"))?window.addEventListener("touchmove",this.handleTouchMove,{passive:!1}):this.findHero(this.onStageHeros,e.touches[0].clientX,e.touches[0].clientY,"on")&&window.addEventListener("touchmove",this.handleTouchMove,{passive:!1})}},{key:"findHero",value:function(e,t,i,n){var s=this,o=e.findIndex((function(e){if(!e)return!1;var n=e.isPointIn(t*s.sizeRate,i*s.sizeRate);if(n){var o=e.point.toNumber();s.mouseSelectItemOffset=[o[0]-t*s.sizeRate,o[1]-i*s.sizeRate]}return n}));return-1!==o&&(this.mouseSelectItem=e[o],this.mouseSelectItemType=n,this.mouseSelectItemIndex=o,this.mouseSelectItemPosition=[t*this.sizeRate,i*this.sizeRate],!0)}},{key:"handleMouseUp",value:function(e){window.removeEventListener("mousemove",this.handleMouseMove),this.handleEventEnd(e.clientX,e.clientY)}},{key:"handleTouchEnd",value:function(e){window.removeEventListener("touchmove",this.handleTouchMove),this.handleEventEnd(e.changedTouches[0].clientX,e.changedTouches[0].clientY)}},{key:"handleEventEnd",value:function(e,t){var i=[e*this.sizeRate+this.mouseSelectItemOffset[0],t*this.sizeRate+this.mouseSelectItemOffset[1]],n=[i[0]+30,i[1]+30],s=this.heroPosList.findIndex((function(e){var t=e.toNumber();return i[0]>t[0]-18&&i[1]>t[1]-18&&n[0]<t[0]+48&&n[1]<t[1]+48}));if(-1!==s&&this.mouseSelectItem)if(0===Math.floor(s/9)){var o=s%9,h=this.offStageHeros[o];this.offStageHeros[o]=null,"on"===this.mouseSelectItemType?this.onStageHeros[this.mouseSelectItemIndex]=null:this.offStageHeros[this.mouseSelectItemIndex]=null,this.addOffStageHero(this.mouseSelectItem,o),"on"===this.mouseSelectItemType?this.addOnStageHero(h,this.mouseSelectItemIndex):this.addOffStageHero(h,this.mouseSelectItemIndex)}else{var a=s%9,r=this.onStageHeros[a];this.onStageHeros[a]=null,"on"===this.mouseSelectItemType?this.onStageHeros[this.mouseSelectItemIndex]=null:this.offStageHeros[this.mouseSelectItemIndex]=null,this.addOnStageHero(this.mouseSelectItem,a),"on"===this.mouseSelectItemType?this.addOnStageHero(r,this.mouseSelectItemIndex):this.addOffStageHero(r,this.mouseSelectItemIndex)}this.isMouseDown=!1,this.mouseSelectItem=null}},{key:"handleMouseMove",value:function(e){this.handleMove(e.clientX,e.clientY)}},{key:"handleTouchMove",value:function(e){e.preventDefault(),e.stopPropagation(),this.handleMove(e.changedTouches[0].clientX,e.changedTouches[0].clientY)}},{key:"handleMove",value:function(e,t){this.mouseSelectItemPosition=[e*this.sizeRate,t*this.sizeRate]}}]),e}(),H=i(6),M=i.n(H),I=i(0),T=new x,E={type:"grapeshot-hero",name:"\u9730\u5f39"},P={type:"lightning-hero",name:"\u95ea\u7535"},N=function(){return[Math.random()>.5?E:P,Math.random()>.5?E:P,Math.random()>.5?E:P,Math.random()>.5?E:P,Math.random()>.5?E:P]},Y=function(){var e=Object(n.useRef)(null),t=Object(n.useState)(!1),i=Object(a.a)(t,2),s=i[0],o=i[1],h=Object(n.useState)(!1),r=Object(a.a)(h,2),l=r[0],c=r[1],u=Object(n.useState)(N()),d=Object(a.a)(u,2),f=d[0],g=d[1],m=Object(n.useState)(!1),v=Object(a.a)(m,2),p=v[0],b=v[1];return Object(n.useEffect)((function(){e.current&&(e.current.width=T.width,e.current.height=T.height)}),[e]),Object(n.useEffect)((function(){T.setEnd=o}),[s]),Object(n.useEffect)((function(){T.render(e.current)}),[e]),Object(n.useEffect)((function(){var e=T.handleMouseUp.bind(T),t=T.handleTouchEnd.bind(T);return window.addEventListener("mouseup",e),window.addEventListener("touchend",t),function(){window.removeEventListener("mouseup",e),window.removeEventListener("touchend",t)}}),[]),Object(I.jsxs)(I.Fragment,{children:[Object(I.jsx)("canvas",{ref:e,className:M.a.canvas,onClick:function(){c(!1),b(!1)},onTouchStart:T.handleTouchStart.bind(T),onMouseDown:T.handleCanvasMouseDown.bind(T)}),Object(I.jsxs)("div",{className:M.a.info,children:[Object(I.jsxs)("div",{children:[Object(I.jsx)("button",{className:M.a.shopBtn,onClick:function(){c(!l),b(!1)},children:"\u5546\u5e97"}),l&&Object(I.jsxs)("div",{className:M.a.shopBox,children:[Object(I.jsx)("ul",{className:M.a.shopList,children:f.map((function(e,t){return Object(I.jsxs)("li",{className:M.a.shopItem,onClick:function(){var t=!1;switch(e.type){case"grapeshot-hero":t=T.buyHero("grapeshot");break;case"lightning-hero":default:t=T.buyHero("lightning")}t?(c(!1),g(N()),b(!1)):b(!0)},children:[e.name,Object(I.jsx)("div",{className:M.a.shopItemPrice,children:"$300"})]},t)}))}),p&&Object(I.jsx)("div",{className:M.a.shopError,children:"\u94b1\u4e0d\u591f\uff01\uff01\uff01\uff01\uff01\uff01"})]})]}),Object(I.jsxs)("div",{className:[M.a.gameEndBox,s?M.a.end:""].join(" "),children:["END",Object(I.jsx)("button",{onClick:function(){T.restart(),o(!1),T.render(e.current)},className:M.a.restartBtn,children:"restart"})]})]})]})},_=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,22)).then((function(t){var i=t.getCLS,n=t.getFID,s=t.getFCP,o=t.getLCP,h=t.getTTFB;i(e),n(e),s(e),o(e),h(e)}))};h.a.render(Object(I.jsx)(s.a.StrictMode,{children:Object(I.jsx)(Y,{})}),document.getElementById("root")),_()},6:function(e,t,i){e.exports={canvas:"App_canvas__1KgDx",info:"App_info__3tKmE",gameEndBox:"App_gameEndBox__e2Cnq",end:"App_end__3t3U7",restartBtn:"App_restartBtn__2M1an",shopBtn:"App_shopBtn__1GjVz",shopBox:"App_shopBox__ApMbX",shopList:"App_shopList__2OMys",shopItem:"App_shopItem__2UEyj",shopItemPrice:"App_shopItemPrice__19Ocx",shopError:"App_shopError__12I5k"}}},[[21,1,2]]]);
//# sourceMappingURL=main.1a52f698.chunk.js.map