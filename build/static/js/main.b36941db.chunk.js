(this["webpackJsonpd-game"]=this["webpackJsonpd-game"]||[]).push([[0],{19:function(e,t,i){},21:function(e,t,i){"use strict";i.r(t);var s=i(5),n=i.n(s),o=i(14),a=i.n(o),h=(i(19),i(4)),r=i(2),l=i(0),c=i(1),u=function(){function e(t,i,s){Object(l.a)(this,e),this.x=0,this.y=0,this.coordinate=void 0,this.x=t,this.y=i,this.coordinate=s}return Object(c.a)(e,[{key:"toNumber",value:function(){return[this.x+this.coordinate.origin[0],this.y+this.coordinate.origin[1]]}},{key:"plus",value:function(t,i){return new e(this.x+t,this.y+i,this.coordinate)}},{key:"lengthTo",value:function(e){var t=this.toNumber(),i=e.toNumber();return Math.pow(Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2),.5)}}]),e}(),g=function(){function e(t,i){Object(l.a)(this,e),this.origin=[0,0],this.origin=[t,i]}return Object(c.a)(e,[{key:"resetOrigin",value:function(e){this.origin=e.toNumber()}},{key:"point",value:function(e,t){return new u(e,t,this)}},{key:"toPoint",value:function(e,t){return new u(e-this.origin[0],t-this.origin[1],this)}}]),e}(),d=function(e,t,i,s,n,o){i<2*n&&(n=i/2),s<2*n&&(n=s/2),o.beginPath(),o.moveTo(e+n,t),o.arcTo(e+i,t,e+i,t+s,n),o.arcTo(e+i,t+s,e,t+s,n),o.arcTo(e,t+s,e,t,n),o.arcTo(e,t,e+i,t,n),o.closePath(),o.stroke()},f=function(e,t,i,s,n){var o=e.toNumber(),a=Object(h.a)(o,2),l=a[0],c=a[1],u=t.toNumber(),g=Object(h.a)(u,2),d=g[0]-l,f=g[1]-c,p=e.lengthTo(t),m=d/p,v=f/p;i.strokeStyle=s||"white",i.shadowColor=n||"blue",i.shadowBlur=14,i.shadowOffsetX=0,i.shadowOffsetY=0,i.beginPath(),i.lineWidth=1,i.moveTo.apply(i,Object(r.a)(e.toNumber()));for(var y=1;y<5;y++){var b=e.plus(d/5*y,f/5*y),S=60*(Math.random()-.5);b=b.plus(S*v,S*m),i.lineTo.apply(i,Object(r.a)(b.toNumber()))}i.lineTo.apply(i,Object(r.a)(t.toNumber())),i.stroke(),i.closePath(),i.beginPath(),i.lineWidth=2,i.moveTo.apply(i,Object(r.a)(e.toNumber()));for(var O=1;O<5;O++){var k=e.plus(d/5*O,f/5*O),w=60*(Math.random()-.5);k=k.plus(w*v,w*m),i.lineTo.apply(i,Object(r.a)(k.toNumber()))}i.lineTo.apply(i,Object(r.a)(t.toNumber())),i.stroke(),i.closePath(),i.shadowBlur=0,i.lineWidth=1,i.strokeStyle="black"},p=function(){function e(t,i,s){Object(l.a)(this,e),this.value=0,this.size=20,this.point=void 0,this.game=void 0,this.isPicked=!1,this.value=t,this.game=s,this.point=new u(i,-this.size,s.coordinate)}return Object(c.a)(e,[{key:"go",value:function(){this.point.y+=.5}},{key:"hited",value:function(e){return e?(this.game.score+=this.value<e?this.value:e,this.value-=e):(this.value--,this.game.score++),this.value<=0&&(this.game.removeEnemy(this),!0)}},{key:"render",value:function(e){var t=this.point.toNumber(),i=Object(h.a)(t,2),s=i[0],n=i[1];d(s,n,this.size,this.size,5,e),e.textAlign="center",e.fillText("".concat(this.value),s+this.size/2,n+13)}}]),e}(),m=i(9),v=i(8),y=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,[{key:"go",value:function(){}},{key:"render",value:function(e){}}]),e}(),b=function(e){Object(m.a)(i,e);var t=Object(v.a)(i);function i(e,s,n,o,a){var h,r=a.speed,c=a.color;return Object(l.a)(this,i),(h=t.call(this)).point=void 0,h.game=void 0,h.size=2,h.direction=0,h.speed=30,h.color="black",h.isEnd=!1,h.hero=void 0,h.point=e,h.direction=s,h.game=n,h.hero=o,r&&(h.speed=r),c&&(h.color=c),h}return Object(c.a)(i,[{key:"go",value:function(){for(var e=this,t=0;t<5*this.speed;t++){if(this.point.y-=Math.cos(this.direction),this.point.x+=Math.sin(this.direction),this.game.enemys.some((function(t){return e.point.x>=t.point.x-2&&e.point.y>=t.point.y-2&&e.point.x<=t.point.x+t.size+2&&e.point.y<=t.point.y+t.size+2&&(t.hited()&&e.hero.addKillNumber(),e.game.removeBullet(e),e.isEnd=!0,!0)})))return}(this.point.y<0||this.point.y>this.game.height||this.point.x<0||this.point.x>this.game.width)&&this.game.removeBullet(this)}},{key:"render",value:function(e){var t=this.point.toNumber(),i=Object(h.a)(t,2),s=i[0],n=i[1];e.beginPath(),e.moveTo(s,n),e.lineTo(s-Math.sin(this.direction)*this.speed,n+Math.cos(this.direction)*this.speed);var o=e.createLinearGradient(s,n,s-Math.sin(this.direction)*this.speed,n+Math.cos(this.direction)*this.speed);o.addColorStop(0,this.color),o.addColorStop(1,"white"),e.strokeStyle=o,e.stroke(),e.closePath(),e.strokeStyle="black"}}]),i}(y),S=function(){function e(t){Object(l.a)(this,e),this.point=void 0,this.level=1,this.color="blue",this.type="hero",this.step=0,this.killNumber=0,this.game=void 0,this.game=t,this.point=new u(0,0,t.coordinate)}return Object(c.a)(e,[{key:"size",get:function(){switch(this.level){case 1:case 2:return 30;default:case 3:return 30}}},{key:"addKillNumber",value:function(){this.killNumber++,this.killNumber>=100&&(this.killNumber=0,this.startSpecialMove())}},{key:"startSpecialMove",value:function(){}},{key:"go",value:function(){this.step++}},{key:"render",value:function(e,t){var i=t||this.point.toNumber(),s=Object(h.a)(i,2),n=s[0],o=s[1];e.strokeStyle=this.color,d(n,o,this.size,this.size,5,e),e.strokeStyle="black",e.fillStyle="white",e.fill(),e.fillStyle=this.color,e.textAlign="center",e.fillText("".concat(this.level),n+this.size/2,o+18),e.fillStyle="green",e.strokeStyle="green",d(n+1,o+this.size+3,this.killNumber/100*(this.size-2),2,1,e),e.fill(),e.strokeStyle="black",e.fillStyle="white",e.fillStyle="black"}},{key:"isPointIn",value:function(e,t){var i=this.point.toNumber(),s=Object(h.a)(i,2),n=s[0],o=s[1];return e>=n-10&&e<=n+this.size+10&&t>=o-10&&t<=o+this.size+10}},{key:"addToOffStage",value:function(e){}}]),e}(),O=function(e){Object(m.a)(i,e);var t=Object(v.a)(i);function i(){var e;Object(l.a)(this,i);for(var s=arguments.length,n=new Array(s),o=0;o<s;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).type="grapeshot-hero",e.color="black",e.specialLength=0,e.nullHero=new S(e.game),e}return Object(c.a)(i,[{key:"cycle",get:function(){switch(this.level){case 1:return 5;case 2:return 3;default:case 3:return 1}}},{key:"go",value:function(){if(this.step%this.cycle===0)for(var e=0;e<5;e++)this.game.bullets.push(new b(this.point.plus(this.size/2,0),.4*Math.PI*(Math.random()-.5),this.game,this,{speed:30+Math.floor(30*Math.random())}));if(0!==this.specialLength){if(this.specialLength%3===0)for(var t=0;t<15;t++)this.game.bullets.push(new b(new u(30*t+10,this.game.targetY,this.game.coordinate),0,this.game,this.nullHero,{speed:30+Math.floor(30*Math.random()),color:"red"}));this.specialLength--}this.step++}},{key:"startSpecialMove",value:function(){this.specialLength=200}}]),i}(S),k=i(10),w=i(6),j=function(e){Object(m.a)(i,e);var t=Object(v.a)(i);function i(e,s){var n;return Object(l.a)(this,i),(n=t.call(this)).game=void 0,n.hero=void 0,n.y=0,n.game=e,n.hero=s,n.y=n.game.targetY,n}return Object(c.a)(i,[{key:"speed",get:function(){switch(this.hero.level){case 1:return 5;case 2:return 3;case 3:default:return 1}}},{key:"go",value:function(){var e=this;this.y-=this.speed,this.game.enemys.forEach((function(t){t.point.y<=e.y&&t.point.y+t.size>=e.y&&t.hited()})),this.y<=0&&this.game.removeBullet(this)}},{key:"render",value:function(e){f(new u(0,this.y,this.game.coordinate),new u(this.game.width,this.y,this.game.coordinate),e,this.hero._color,this.hero._lightColor)}}]),i}(y),H=function(e){Object(m.a)(i,e);var t=Object(v.a)(i);function i(){var e;Object(l.a)(this,i);for(var s=arguments.length,n=new Array(s),o=0;o<s;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).type="lightning-hero",e.targets={length:0,chain:null,end:null},e}return Object(c.a)(i,[{key:"cycle",get:function(){switch(this.level){case 1:return 3;case 2:return 2;default:case 3:return 1}}},{key:"_color",get:function(){switch(this.level){case 1:case 2:return"white";default:case 3:return"black"}}},{key:"_lightColor",get:function(){switch(this.level){case 1:return"blue";case 2:return"red";default:case 3:return"red"}}},{key:"targetMaxLength",get:function(){switch(this.level){case 1:return 2;case 2:return 3;default:case 3:return 5}}},{key:"go",value:function(){if(this.targets.length<this.targetMaxLength&&this.game.enemys.length>0){for(var e=this.game.enemys.length>=this.targetMaxLength?this.targetMaxLength:this.game.enemys.length,t=e-this.targets.length;0!==t;){var i=this.game.enemys.length,s=Math.floor(i*Math.random());if(this.targets.chain)this.addTarget({value:this.game.enemys[s],next:null})&&t--;else this.addTarget({value:this.game.enemys[s],next:null}),t--}this.targets.length=e}if(this.step%this.cycle===0){for(var n=this.targets.chain;n;){if(n.value.value>0)n.value.hited()&&this.addKillNumber();n=n.next}if(!(n=this.targets.chain))return;if(n.value.value<=0)this.targets.length=0,this.targets.chain=null,this.targets.end=null;else{var o=n;n=n.next;for(var a=1;n;){if(n.value.value<=0){o.next=null,this.targets.length=a,this.targets.end=o;break}o=n,n=n.next,a++}}}this.step++}},{key:"render",value:function(e,t){if(Object(k.a)(Object(w.a)(i.prototype),"render",this).call(this,e,t),this.targets.chain)for(var s=this.targets.chain,n=this.point.plus(this.size/2,0);s;){var o=s.value.point.plus(s.value.size/2,s.value.size/2);f(n,o,e,this._color,this._lightColor),n=s.value.point.plus(s.value.size/2,s.value.size/2),s=s.next}}},{key:"startSpecialMove",value:function(){this.game.bullets.push(new j(this.game,this))}},{key:"addTarget",value:function(e){if(null===this.targets.end)this.targets.chain=e,this.targets.end=e,this.targets.length++;else{for(var t=this.targets.chain;t;){if(e.value===t.value)return!1;t=t.next}this.targets.end.next=e,this.targets.end=this.targets.end.next,this.targets.length++}return!0}},{key:"addToOffStage",value:function(e){Object(k.a)(Object(w.a)(i.prototype),"addToOffStage",this).call(this,e),this.targets={length:0,chain:null,end:null}}}]),i}(S),x=function(e){Object(m.a)(i,e);var t=Object(v.a)(i);function i(e,s,n,o,a){var h,r=a.speed,c=a.color,u=a.damage;Object(l.a)(this,i),(h=t.call(this)).point=void 0,h.startPoint=void 0,h.targetPoint=void 0,h.game=void 0,h.hero=void 0,h.damage=0,h.sin=0,h.cos=0,h.speed=30,h.color="black",h.game=e,h.hero=s,h.startPoint=n,h.point=n.plus(0,0),h.targetPoint=o,r&&(h.speed=r),c&&(h.color=c),h.damage=u;var g=h.targetPoint.y-h.startPoint.y,d=h.targetPoint.x-h.startPoint.x,f=Math.pow(Math.pow(g,2)+Math.pow(d,2),.5);return h.sin=d/f,h.cos=-g/f,h}return Object(c.a)(i,[{key:"go",value:function(){for(var e=this,t=0;t<5*this.speed;t++)this.point.y+=-this.cos,this.point.x+=this.sin,this.game.enemys.forEach((function(t){return e.point.x>=t.point.x-2&&e.point.y>=t.point.y-2&&e.point.x<=t.point.x+t.size+2&&e.point.y<=t.point.y+t.size+2&&(t.hited(e.damage)&&e.hero.addKillNumber(),!0)}));(this.point.y<0||this.point.y>this.game.height||this.point.x<0||this.point.x>this.game.width)&&this.game.removeBullet(this)}},{key:"render",value:function(e){var t=this.point.toNumber(),i=Object(h.a)(t,2),s=i[0],n=i[1];e.beginPath(),e.moveTo(s,n),e.lineTo(s-150*this.sin,n+150*this.cos);var o=e.createLinearGradient(s,n,s-150*this.sin,n+150*this.cos);o.addColorStop(0,this.color),o.addColorStop(1,"white"),e.strokeStyle=o,e.lineWidth=2,e.stroke(),e.closePath(),e.strokeStyle="black",e.lineWidth=1}}]),i}(y),P=function(e){Object(m.a)(i,e);var t=Object(v.a)(i);function i(){var e;Object(l.a)(this,i);for(var s=arguments.length,n=new Array(s),o=0;o<s;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))).type="sniper-hero",e.target=null,e.damage=0,e.color="green",e.nullHero=new S(e.game),e.specialTargets=[],e.specialDamage=-1,e.specialDamageMax=30,e}return Object(c.a)(i,[{key:"cycle",get:function(){switch(this.level){case 1:return 5;case 2:return 3;default:case 3:return 2}}},{key:"go",value:function(){var e=this;if(!this.target){var t=this.game.enemys[0];if(this.game.enemys.forEach((function(e){!e.isPicked&&e.value>t.value&&(t=e)})),!t)return Object(k.a)(Object(w.a)(i.prototype),"go",this).call(this);this.target=t,this.target.isPicked=!0}if(this.step%this.cycle!==0)return Object(k.a)(Object(w.a)(i.prototype),"go",this).call(this);this.damage<this.target.value?this.damage+=1:(this.game.bullets.push(new x(this.game,this,this.point.plus(this.size/2,0),this.target.point.plus(this.target.size/2,this.target.size/2),{damage:this.damage})),this.damage=0,this.target.isPicked=!1,this.target=null),this.specialDamage>0&&(this.specialDamage++,this.specialTargets=this.specialTargets.filter((function(e){return e.value>0})),this.specialDamage>=this.specialDamageMax&&(this.specialTargets.forEach((function(t){e.game.bullets.push(new x(e.game,e.nullHero,e.point.plus(e.size/2,0),t.point.plus(t.size/2,t.size/2),{damage:e.specialDamage}))})),this.specialDamage=-1,this.specialTargets=[])),Object(k.a)(Object(w.a)(i.prototype),"go",this).call(this)}},{key:"startSpecialMove",value:function(){for(var e=this,t=new Set;t.size<12;)t.add(Math.floor(Math.random()*this.game.enemys.length));t.forEach((function(t){e.specialTargets.push(e.game.enemys[t])})),console.log("special",this.specialTargets),this.specialDamage=1}},{key:"render",value:function(e,t){var s=this;Object(k.a)(Object(w.a)(i.prototype),"render",this).call(this,e,t),this.target&&this.renderTarget(e,this.target,5+(this.target.value-this.damage>0?this.target.value-this.damage:0)),this.specialTargets.forEach((function(t){s.renderTarget(e,t,5+s.specialDamageMax-s.specialDamage)}))}},{key:"renderTarget",value:function(e,t,i){e.strokeStyle="red",e.lineWidth=3,e.beginPath(),e.arc.apply(e,Object(r.a)(t.point.plus(t.size/2,t.size/2).toNumber()).concat([i,0,2*Math.PI])),e.moveTo.apply(e,Object(r.a)(t.point.plus(t.size/2,t.size/2+i+5).toNumber())),e.lineTo.apply(e,Object(r.a)(t.point.plus(t.size/2,t.size/2+i-5).toNumber())),e.moveTo.apply(e,Object(r.a)(t.point.plus(t.size/2,t.size/2-i+5).toNumber())),e.lineTo.apply(e,Object(r.a)(t.point.plus(t.size/2,t.size/2-i-5).toNumber())),e.moveTo.apply(e,Object(r.a)(t.point.plus(t.size/2+i+5,t.size/2).toNumber())),e.lineTo.apply(e,Object(r.a)(t.point.plus(t.size/2+i-5,t.size/2).toNumber())),e.moveTo.apply(e,Object(r.a)(t.point.plus(t.size/2-i+5,t.size/2).toNumber())),e.lineTo.apply(e,Object(r.a)(t.point.plus(t.size/2-i-5,t.size/2).toNumber())),e.stroke(),e.closePath(),e.strokeStyle="black",e.lineWidth=1}}]),i}(S),M=function(){function e(t){Object(l.a)(this,e),this.game=void 0,this.waveNumber=30,this.symbolLife=100,this.isEnd=!1,this.game=t}return Object(c.a)(e,[{key:"createEnemy",value:function(){for(var e=0;e<15;e++)this.game.enemys.push(new p(Math.ceil(this.game.step/150*Math.random()+1),30*e+10,this.game))}},{key:"go",value:function(){0!==this.waveNumber?this.game.step%this.game.cycle===0&&(this.createEnemy(),this.waveNumber--):this.isEnd=!0}},{key:"award",value:function(){}},{key:"renderSymbol",value:function(e){e.beginPath(),e.font="italic bolder 60px Arial",e.fillStyle="grey",e.textAlign="center",e.fillText("ROUND ".concat(this.game.stageNumber+1),this.game.width/2,this.game.height-350),e.font="12px Arial",e.fillStyle="black",e.closePath()}}]),e}(),T=/Android|webOS|iPhone|iPod|BlackBerry/i.test(window.navigator.userAgent),N=function(e){return[new M(e),new M(e),new M(e),new M(e)]},z=function(){function e(){Object(l.a)(this,e),this.coordinate=new g(0,0),this.enemys=[],this.offStageHeros=[null,null,null,null,null,null,null,null,null],this.onStageHeros=[null,null,null,null,null,null,null,null,null],this.bullets=[],this.width=460,this.height=460*window.innerHeight/window.innerWidth,this.sizeRate=460/window.innerWidth,this.targetY=this.height-150,this.targetLineLeft=this.coordinate.point(0,this.targetY),this.targetLineRight=this.coordinate.point(this.width,this.targetY),this.offStageHeroY=this.height-70,this.onStageHeroY=this.height-120,this.heroPosList=[new u(55,this.offStageHeroY,this.coordinate),new u(95,this.offStageHeroY,this.coordinate),new u(135,this.offStageHeroY,this.coordinate),new u(175,this.offStageHeroY,this.coordinate),new u(215,this.offStageHeroY,this.coordinate),new u(255,this.offStageHeroY,this.coordinate),new u(295,this.offStageHeroY,this.coordinate),new u(335,this.offStageHeroY,this.coordinate),new u(375,this.offStageHeroY,this.coordinate),new u(55,this.onStageHeroY,this.coordinate),new u(95,this.onStageHeroY,this.coordinate),new u(135,this.onStageHeroY,this.coordinate),new u(175,this.onStageHeroY,this.coordinate),new u(215,this.onStageHeroY,this.coordinate),new u(255,this.onStageHeroY,this.coordinate),new u(295,this.onStageHeroY,this.coordinate),new u(335,this.onStageHeroY,this.coordinate),new u(375,this.onStageHeroY,this.coordinate)],this.cycle=60,this.step=0,this.setEnd=null,this.setRound=null,this.$=300,this.score=0,this.HP=1e3,this.renderHP=1e3,this.result="win",this._round="strategy",this.stageNumber=0,this.stage=N(this),this.isRenderStrategy=!1,this.isMouseDown=!1,this.mouseSelectItem=null,this.mouseSelectItemType="off",this.mouseSelectItemIndex=0,this.mouseSelectItemPosition=[0,0],this.mouseSelectItemOffset=[0,0],this.canvas=null,this.handleMouseMove=this.handleMouseMove.bind(this),this.handleTouchMove=this.handleTouchMove.bind(this)}return Object(c.a)(e,[{key:"round",get:function(){return this._round},set:function(e){this._round=e,this.setRound&&this.setRound(e),"fighting"===e&&this.goFighting()}},{key:"restart",value:function(){this.enemys=[],this.offStageHeros=[null,null,null,null,null,null,null,null,null],this.onStageHeros=[null,null,null,null,null,null,null,null,null],this.bullets=[],this.step=0,this.$=300,this.score=0,this.HP=1e3,this.stageNumber=0,this.round="strategy",this.stage=N(this),this.render()}},{key:"addEnemy",value:function(){for(var e=0;e<15;e++)this.enemys.push(new p(Math.ceil(this.step/150*Math.random()+1),30*e+10,this))}},{key:"removeBullet",value:function(e){this.bullets=this.bullets.filter((function(t){return t!==e}))}},{key:"removeEnemy",value:function(e){this.enemys=this.enemys.filter((function(t){return t!==e})),this.$++}},{key:"buyHero",value:function(e){switch(e){case"lightning":if(this.$<300)return!1;this.$-=300,this.addOffStageHero(new H(this));break;case"sniper":if(this.$<200)return!1;this.$-=200,this.addOffStageHero(new P(this));break;case"grapeshot":default:if(this.$<300)return!1;this.$-=300,this.addOffStageHero(new O(this))}return this.render(),!0}},{key:"go",value:function(){var e=this;return this.stage[this.stageNumber].go(),this.enemys.forEach((function(t){t.go(),t.point.y>=e.targetY-t.size&&(e.removeEnemy(t),e.HP-=t.value>e.HP?e.HP:t.value)})),this.onStageHeros.forEach((function(e){null===e||void 0===e||e.go()})),this.bullets.forEach((function(e){e.go()})),this.renderHP>this.HP?this.renderHP--:this.renderHP<this.HP&&this.renderHP++,this.step++,this.HP<=0}},{key:"goFighting",value:function(){var e=this;return this.go()?(this.setResult("loose"),this.renderHP=0,void this.render()):(this.render(),this.stage[this.stageNumber].isEnd&&0===this.bullets.length&&0===this.enemys.length&&this.renderHP===this.HP?(this.round="strategy",this.stageNumber++,this.stageNumber===this.stage.length?void this.setResult("win"):void this.stage[this.stageNumber].award()):void requestAnimationFrame((function(){e.goFighting()})))}},{key:"goStrategy",value:function(){this.isRenderStrategy||this.loopRender()}},{key:"loopRender",value:function(){var e=this;this.render(),this.isRenderStrategy&&requestAnimationFrame((function(){e.loopRender()}))}},{key:"render",value:function(){if(this.canvas){var e=this.canvas.getContext("2d");if(e){e.clearRect(0,0,this.canvas.width,this.canvas.height),e.strokeRect.apply(e,Object(r.a)(this.coordinate.origin).concat([this.width,this.height])),this.stage[this.stageNumber].renderSymbol(e),e.beginPath(),e.strokeStyle="grey",this.heroPosList.forEach((function(t){d.apply(void 0,Object(r.a)(t.plus(8,8).toNumber()).concat([14,14,5,e]))})),e.strokeStyle="black",e.closePath(),this.enemys.forEach((function(t){t.render(e)})),e.beginPath(),e.fillStyle="white",e.fillRect(1,this.targetY-30,this.width-2,32),e.fillStyle="lightgrey",e.fillRect(1,this.targetY-25,this.width-2,10),e.fillStyle="lightgreen",e.strokeStyle="green";var t=this.renderHP/1e3*(this.width-2);e.fillRect(this.width-t-1,this.targetY-25,t,10),e.closePath(),e.fillStyle="black",e.strokeStyle="black",e.beginPath(),this.offStageHeros.forEach((function(t){null===t||void 0===t||t.render(e)})),this.onStageHeros.forEach((function(t){null===t||void 0===t||t.render(e)})),e.closePath(),e.beginPath(),e.moveTo.apply(e,Object(r.a)(this.targetLineLeft.plus(0,-30).toNumber())),e.lineTo.apply(e,Object(r.a)(this.targetLineRight.plus(0,-30).toNumber())),e.stroke(),e.closePath(),e.beginPath(),this.bullets.forEach((function(t){t.render(e)})),e.closePath(),this.mouseSelectItem&&(this.mouseSelectItem.render(e,[this.mouseSelectItemPosition[0]+this.mouseSelectItemOffset[0],this.mouseSelectItemPosition[1]+this.mouseSelectItemOffset[1]]),T&&(e.putImageData(e.getImageData(0,this.targetY,this.width,150),0,this.targetY-150),e.rect(0,this.targetY-150,this.width,150),e.stroke())),e.beginPath(),e.font="bold 24px Arial",e.fillStyle="red",e.textAlign="right",e.fillText("$:".concat(this.$),440,30),e.font="12px Arial",e.fillStyle="black",e.closePath(),e.beginPath(),e.font="bold 24px Arial",e.fillStyle="red",e.textAlign="left",e.fillText("score:".concat(this.score),20,30),e.font="12px Arial",e.fillStyle="black",e.closePath()}}}},{key:"setResult",value:function(e){this.result=e,this.setEnd&&this.setEnd(!0)}},{key:"addOffStageHero",value:function(e,t){if(void 0===t&&this.offStageHeros.some((function(e,i){return null===e&&(t=i,!0)})),void 0!==t&&(this.offStageHeros[t]=e,e)){if(e.point.y=this.offStageHeroY,e.point.x=55+40*t,e.addToOffStage(t),e.level>=3)return;var i=[];this.offStageHeros.forEach((function(t,s){(null===t||void 0===t?void 0:t.type)===e.type&&e.level===t.level&&i.push(s)})),i.length>=3&&(this.addOffStageHero(null,i[0]),this.addOffStageHero(null,i[1]),this.offStageHeros[i[2]].level+=1,this.addOffStageHero(this.offStageHeros[i[2]],i[2]))}}},{key:"addOnStageHero",value:function(e,t){if(void 0===t&&this.onStageHeros.some((function(e,i){return null===e&&(t=i,!0)})),void 0!==t&&(this.onStageHeros[t]=e,e)){if(e.point.y=this.onStageHeroY,e.point.x=55+40*t,e.level>=3)return;var i=[];this.onStageHeros.forEach((function(t,s){(null===t||void 0===t?void 0:t.type)===e.type&&e.level===t.level&&i.push(s)})),i.length>=3&&(this.addOnStageHero(null,i[0]),this.addOnStageHero(null,i[1]),this.onStageHeros[i[2]].level+=1,this.addOnStageHero(this.onStageHeros[i[2]],i[2]))}}},{key:"handleCanvasMouseDown",value:function(e){if("fighting"!==this.round)return this.isMouseDown=!0,this.findHero(this.offStageHeros,e.clientX,e.clientY,"off")||this.findHero(this.onStageHeros,e.clientX,e.clientY,"on")?(window.addEventListener("mousemove",this.handleMouseMove),this.isRenderStrategy=!0,void this.loopRender()):void 0}},{key:"handleTouchStart",value:function(e){if("fighting"!==this.round)return e.stopPropagation(),e.preventDefault(),this.isMouseDown=!0,this.findHero(this.offStageHeros,e.touches[0].clientX,e.touches[0].clientY,"off")||this.findHero(this.onStageHeros,e.touches[0].clientX,e.touches[0].clientY,"on")?(window.addEventListener("touchmove",this.handleTouchMove,{passive:!1}),this.isRenderStrategy=!0,void this.loopRender()):void 0}},{key:"findHero",value:function(e,t,i,s){var n=this,o=e.findIndex((function(e){if(!e)return!1;var s=e.isPointIn(t*n.sizeRate,i*n.sizeRate);if(s){var o=e.point.toNumber();n.mouseSelectItemOffset=[o[0]-t*n.sizeRate,o[1]-i*n.sizeRate]}return s}));return-1!==o&&(this.mouseSelectItem=e[o],this.mouseSelectItemType=s,this.mouseSelectItemIndex=o,this.mouseSelectItemPosition=[t*this.sizeRate,i*this.sizeRate],!0)}},{key:"handleMouseUp",value:function(e){window.removeEventListener("mousemove",this.handleMouseMove),this.handleEventEnd(e.clientX,e.clientY)}},{key:"handleTouchEnd",value:function(e){window.removeEventListener("touchmove",this.handleTouchMove),this.handleEventEnd(e.changedTouches[0].clientX,e.changedTouches[0].clientY)}},{key:"handleEventEnd",value:function(e,t){var i=[e*this.sizeRate+this.mouseSelectItemOffset[0],t*this.sizeRate+this.mouseSelectItemOffset[1]],s=[i[0]+30,i[1]+30],n=this.heroPosList.findIndex((function(e){var t=e.toNumber();return i[0]>t[0]-18&&i[1]>t[1]-18&&s[0]<t[0]+48&&s[1]<t[1]+48}));if(-1!==n&&this.mouseSelectItem)if(0===Math.floor(n/9)){var o=n%9,a=this.offStageHeros[o];this.offStageHeros[o]=null,"on"===this.mouseSelectItemType?this.onStageHeros[this.mouseSelectItemIndex]=null:this.offStageHeros[this.mouseSelectItemIndex]=null,this.addOffStageHero(this.mouseSelectItem,o),"on"===this.mouseSelectItemType?this.addOnStageHero(a,this.mouseSelectItemIndex):this.addOffStageHero(a,this.mouseSelectItemIndex)}else{var h=n%9,r=this.onStageHeros[h];this.onStageHeros[h]=null,"on"===this.mouseSelectItemType?this.onStageHeros[this.mouseSelectItemIndex]=null:this.offStageHeros[this.mouseSelectItemIndex]=null,this.addOnStageHero(this.mouseSelectItem,h),"on"===this.mouseSelectItemType?this.addOnStageHero(r,this.mouseSelectItemIndex):this.addOffStageHero(r,this.mouseSelectItemIndex)}this.isMouseDown=!1,this.mouseSelectItem=null,this.isRenderStrategy=!1}},{key:"handleMouseMove",value:function(e){this.handleMove(e.clientX,e.clientY)}},{key:"handleTouchMove",value:function(e){e.preventDefault(),e.stopPropagation(),this.handleMove(e.changedTouches[0].clientX,e.changedTouches[0].clientY)}},{key:"handleMove",value:function(e,t){this.mouseSelectItemPosition=[e*this.sizeRate,t*this.sizeRate]}}]),e}(),I=i(7),E=i.n(I),_=i(3),Y=new z,R={type:"grapeshot-hero",name:"\u9730\u5f39",price:300},L={type:"lightning-hero",name:"\u95ea\u7535",price:300},A={type:"sniper-hero",name:"\u72d9\u51fb\u624b",price:200},D=function(){var e=Math.random();return e<.33?R:e<.66?L:A},B=function(){return[D(),D(),D(),D(),D()]},C=function(){var e=Object(s.useRef)(null),t=Object(s.useState)(!1),i=Object(h.a)(t,2),n=i[0],o=i[1],a=Object(s.useState)(!1),r=Object(h.a)(a,2),l=r[0],c=r[1],u=Object(s.useState)(B()),g=Object(h.a)(u,2),d=g[0],f=g[1],p=Object(s.useState)(!1),m=Object(h.a)(p,2),v=m[0],y=m[1],b=Object(s.useState)("strategy"),S=Object(h.a)(b,2),O=S[0],k=S[1];return Object(s.useEffect)((function(){e.current&&(e.current.width=Y.width,e.current.height=Y.height)}),[e]),Object(s.useEffect)((function(){Y.setEnd=o}),[n]),Object(s.useEffect)((function(){Y.setRound=k}),[O]),Object(s.useEffect)((function(){Y.canvas=e.current,Y.render()}),[e]),Object(s.useEffect)((function(){var e=Y.handleMouseUp.bind(Y),t=Y.handleTouchEnd.bind(Y);return window.addEventListener("mouseup",e),window.addEventListener("touchend",t),function(){window.removeEventListener("mouseup",e),window.removeEventListener("touchend",t)}}),[]),Object(_.jsxs)(_.Fragment,{children:[Object(_.jsx)("canvas",{ref:e,className:E.a.canvas,onClick:function(){c(!1),y(!1)},onTouchStart:Y.handleTouchStart.bind(Y),onMouseDown:Y.handleCanvasMouseDown.bind(Y)}),Object(_.jsxs)("div",{className:E.a.info,children:[Object(_.jsxs)("div",{children:[Object(_.jsx)("button",{className:E.a.shopBtn,onClick:function(){c(!l),y(!1)},children:"\u5546\u5e97"}),l&&Object(_.jsxs)("div",{className:E.a.shopBox,children:[Object(_.jsx)("ul",{className:E.a.shopList,children:d.map((function(e,t){return Object(_.jsxs)("li",{className:E.a.shopItem,onClick:function(){var t=!1;switch(e.type){case"grapeshot-hero":t=Y.buyHero("grapeshot");break;case"sniper-hero":t=Y.buyHero("sniper");break;case"lightning-hero":default:t=Y.buyHero("lightning")}t?(c(!1),f(B()),y(!1)):y(!0)},children:[e.name,Object(_.jsxs)("div",{className:E.a.shopItemPrice,children:["$",e.price]})]},t)}))}),v&&Object(_.jsx)("div",{className:E.a.shopError,children:"\u94b1\u4e0d\u591f\uff01\uff01\uff01\uff01\uff01\uff01"})]})]}),Object(_.jsxs)("div",{className:[E.a.gameEndBox,n?E.a.end:""].join(" "),children:["win"===Y.result?"\u606d\u559c\ud83c\udf89":"game over",Object(_.jsx)("button",{onClick:function(){Y.restart(),o(!1),Y.canvas=e.current},className:E.a.restartBtn,children:"restart"})]}),Object(_.jsx)("div",{children:"strategy"===O&&Object(_.jsx)("button",{className:E.a.startFighting,onClick:function(){Y.round="fighting"},children:"\u7ed3\u675f\u56de\u5408"})})]})]})},F=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,22)).then((function(t){var i=t.getCLS,s=t.getFID,n=t.getFCP,o=t.getLCP,a=t.getTTFB;i(e),s(e),n(e),o(e),a(e)}))};a.a.render(Object(_.jsx)(n.a.StrictMode,{children:Object(_.jsx)(C,{})}),document.getElementById("root")),F()},7:function(e,t,i){e.exports={canvas:"App_canvas__1KgDx",info:"App_info__3tKmE",gameEndBox:"App_gameEndBox__e2Cnq",end:"App_end__3t3U7",restartBtn:"App_restartBtn__2M1an",shopBtn:"App_shopBtn__1GjVz",shopBox:"App_shopBox__ApMbX",shopList:"App_shopList__2OMys",shopItem:"App_shopItem__2UEyj",shopItemPrice:"App_shopItemPrice__19Ocx",shopError:"App_shopError__12I5k",startFighting:"App_startFighting__ner9a"}}},[[21,1,2]]]);
//# sourceMappingURL=main.b36941db.chunk.js.map